{% block main %}
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">
<script src="https://cdn.jsdelivr.net/npm/jquery@3.6.3/dist/jquery.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>

<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.0/css/all.css"
  integrity="sha384-lZN37f5QGtY3VHgisS14W3ExzMWZxybE1SJSEsQp9S+oqd12jhcu+A56Ebc1zFSJ" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">


<h2 style="text-align: center;">Bảng chấm công</h2>

<div class="row">
  <div class="col-md-4">
    <a href="{% url 'admin_home' %}" class="btn btn-secondary "><i class="fa fa-home"></i> Trang chủ</a>
    <a href="{% url 'download_excel' %}" class="btn btn-primary "><i class="fa fa-file-download"></i> Tải file Excel</a>
  </div>

  <div class="row">
    <div class="col-md-2">
      <div class="text-right">
        Từ ngày
      </div>
    </div>
    <div class="col-md-4">
      <input type="date" name="start_date" id="start_date" class="form-control" required>
    </div>
    <div class="col-md-2">
      <div class="text-right">
        Đến ngày
      </div>
    </div>
    <div class="col-md-4">
      <input type="date" name="end_date" id="end_date" class="form-control" required>
    </div>
  </div>
</div>

<div id="iframe-container">
  <iframe srcdoc="{{ html_table }}" style="width: 100%; height: 100%; border: none;"></iframe>
</div>



<script>
  var startDate = null;
  var endDate = null;

  // Lắng nghe sự kiện khi ngày bắt đầu thay đổi
  document.getElementById('start_date').addEventListener('change', function () {
    startDate = document.getElementById('start_date').value;
    if (startDate && endDate) {
      updateAttendance();
    }
  });

  // Lắng nghe sự kiện khi ngày kết thúc thay đổi
  document.getElementById('end_date').addEventListener('change', function () {
    endDate = document.getElementById('end_date').value;
    if (startDate && endDate) {
      updateAttendance();
    }
  });

  // Hàm gửi dữ liệu thời gian tới file view
  function updateAttendance() {
    var data = {
      'start_date': startDate,
      'end_date': endDate
    };

    // Gửi request đến file view để xử lý
    fetch('{% url "query_attendance_all" %}', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'X-CSRFToken': '{{ csrf_token }}'
      },
      body: JSON.stringify(data)
    })
      .then(response => response.json())
      .then(data => {
        // Xử lý dữ liệu trả về và tải lại trang
        location.reload();
      })
      .catch(error => {
        console.error('Error:', error);
      });
  }

</script>



{% endblock %}